{% extends "back_base_layout.twig" %}

{% block vendor_stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ base_url('assets/back/vendor/datatables/datatables.min.css') }}"/>
    <link rel="stylesheet" href="{{ base_url('assets/back/vendor/select2/dist/css/select2.min.css') }}"/>
{% endblock %}

{% block body %}
    <section class="content">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-12">
                    {{ validation_errors('<div class="panel panel-filled panel-c-danger"><div class="panel-heading">', '</div></div>') | raw}}

                    {% if session.flashdata.error == TRUE %}
                        <div class="panel panel-filled panel-c-danger"><div class="panel-heading">{{ session.flashdata.error }}</div></div>
                    {% elseif session.flashdata.success == TRUE %}
                        <div class="panel panel-filled panel-c-success"><div class="panel-heading">{{ session.flashdata.success }}</div></div>
                    {% endif %}
                </div>
            </div>

            <div class="row">
                <div class="col-lg-12">
                    <div class="view-header">
                        <div class="pull-right text-right" style="line-height: 14px">
                            <small>Luna Admin Theme<br>Dashboard<br> <span class="c-white">v.1.3</span></small>
                        </div>
                        <div class="header-icon">
                            <i class="pe page-header-icon pe-7s-news-paper"></i>
                        </div>
                        <div class="header-title">
                            <h3 class="m-b-xs">Zawartość | <span class="text-muted">Strony</span></h3>
                            <small>
                                Możliwość przeglądania utworzonych stron oraz dodawania nowych
                            </small>
                        </div>
                    </div>
                    <hr>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12">
                    <div class="panel panel-filled">
                        <div class="panel-heading">
                            <div class="panel-tools">
                                <button class="btn btn-w-md btn-success" data-toggle="modal" data-target="#modalADD">Dodaj stronę</button>
                            </div>
                            Tabelaryczna lista wszystkich utworzonych stron

                        </div>
                        <div class="panel-body">
                            <p>
                                Wskazówka: pole <code>Szukaj</code> pomoże w szybkim odnalezieniu strony, a kliknięcie w daną wartość w kolumnie pozwoli na szybką edycję danych, natomiast kliknięcie w dany przycisk pozwoli na określnoą akcję
                            </p>
                            <div class="table-responsive">
                                <table id="tableExample2" class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>Tytuł</th>
                                            <th>Odnośnik</th>
                                            <th>Status</th>
                                            <th style="width: 100px;">Akcja</th>
                                        </tr>
                                    </thead>
                                    <tbody>

                                    {% for page in pages %}
                                    <tr>
                                        <td><a href="#" class="popup_edit" data-type="text" data-pk="{{ page.pa_id }}" data-url="{{ base_url('back/content/inline_update') }}" data-name="pa_title">{{ page.pa_title }}</a></td>
                                        <td><a href="#" class="popup_edit" data-type="text" data-pk="{{ page.pa_id }}" data-url="{{ base_url('back/content/inline_update') }}" data-name="pa_slug">{{ page.pa_slug }}</a></td>
                                        <td><a href="#" class="popup_edit" data-type="select" data-pk="{{ page.pa_id }}" data-url="{{ base_url('back/content/inline_update') }}" data-name="pa_status" data-source="[{'value':'Aktywna', 'text':'Aktywna'},{'value':'Nieaktywna', 'text':'Nieaktywna'}]" data-value="{{ page.pa_status }}">{{ page.pa_status }}</a></td>
                                        <td>
                                            <a href="{{ base_url('back/content/edit/' ~ page.pa_id) }}" class="btn btn-success btn-xs">Edytuj</a>
                                            <button type="button" class="btn btn-danger btn-xs" data-toggle="modal" data-target="#deletePage-{{ page.pa_id }}"><i class="fa fa-trash"></i> Usuń</button>

                                            <div class="modal fade" id="deletePage-{{ page.pa_id }}" tabindex="-1" role="dialog" aria-hidden="true" style="display: none;">
                                                <div class="modal-dialog modal-sm">
                                                    <div class="modal-content">
                                                        <div class="modal-header text-center">
                                                            <h4 class="modal-title">Usuwanie strony</h4>
                                                            <h4>{{ page.pa_title }}</h4>
                                                        </div>
                                                        <div class="modal-body">
                                                            <p><strong>Czy na pewno chcesz usunąć tą stronę? </strong></p>
                                                        </div>
                                                        <div class="modal-footer">
                                                            <button type="button" class="btn btn-default" data-dismiss="modal">Anuluj</button>
                                                            <a href="{{ base_url('back/content/delete/' ~ page.pa_id) }}" class="btn btn-danger">Usuń</a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    {% endfor %}

                                    </tbody>
                                </table>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <div class="modal fade" id="modalADD" role="dialog" aria-hidden="true" style="display: none;">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header text-center">
                    <h4 class="modal-title">Strona</h4>
                    <small>Dodaj nową stronę</small>
                </div>
                <div class="modal-body">

                    {{ form_open('', 'class="form-horizontal"') }}
                    <div class="form-group"><label for="pa_title" class="col-sm-4 control-label">Tytuł <code>*</code></label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="pa_title" placeholder="Podaj tytuł strony" name="pa_title">
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Anuluj</button>
                    <input type="submit" class="btn btn-accent" value="Dodaj">
                </div>
                {{ form_close() }}

            </div>
        </div>
    </div>
{% endblock %}

{% block vendor_scripts %}
    {{ parent() }}
    <script src="{{ base_url('assets/back/vendor/datatables/datatables.min.js') }}"></script>
    <script src="{{ base_url('assets/back/vendor/select2/dist/js/select2.js') }}"></script>

    <script>
    $(document).ready(function () {
        $('#tableExample2').DataTable({
            "dom": "<'row'<'col-sm-6'l><'col-sm-6'f>>t<'row'<'col-sm-6'i><'col-sm-6'p>>",
            "lengthMenu": [ [6, 25, 50, -1], [6, 25, 50, "Wszystko"] ],
            "iDisplayLength": 6,

            "fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {

                $('.popup_edit').editable({
                    ajaxOptions: {
                        dataType: 'json' //assuming json response
                    },
                    emptytext: 'Brak danych',
                    success: function(data, newValue) {
                        if(data.status == 0) {
                            return data.msg; // Message will be shown in editable form
                        } else {
                            setTimeout(function(){ // Run toastr notification with success message
                                toastr.options = {
                                    "positionClass": "toast-top-right",
                                    "closeButton": true,
                                    "progressBar": true,
                                    "showEasing": "swing",
                                    "timeOut": "6000"
                                };
                                toastr.success('<strong>Sukces! </strong> <br/><small>' + data.msg + '</small>');
                                },500
                            );
                        }
                    }
                });
            }
        });

        $(".select2_demo_1").select2();
    });

    $(function () {
        $('[data-toggle="tooltip"]').tooltip()
    })
</script>
{% endblock %}