{% extends "back_base_layout.twig" %}

{% block vendor_stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ base_url('assets/back/vendor/datatables/datatables.min.css') }}"/>
{% endblock %}

{% block body %}
    <section class="content">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-12">
                    {{ validation_errors('<div class="panel panel-filled panel-c-danger"><div class="panel-heading">', '</div></div>') | raw}}

                    {% if session.flashdata.error == TRUE %}
                        <div class="panel panel-filled panel-c-danger"><div class="panel-heading">{{ session.flashdata.error }}</div></div>
                    {% elseif session.flashdata.success == TRUE %}
                        <div class="panel panel-filled panel-c-success"><div class="panel-heading">{{ session.flashdata.success }}</div></div>
                    {% endif %}
                </div>
            </div>

            <div class="row">
                <div class="col-lg-12">
                    <div class="view-header">
                        <div class="pull-right text-right" style="line-height: 14px">
                            <small>Luna Admin Theme<br>Dashboard<br> <span class="c-white">v.1.3</span></small>
                        </div>
                        <div class="header-icon">
                            <i class="pe page-header-icon pe-7s-users"></i>
                        </div>
                        <div class="header-title">
                            <h3 class="m-b-xs">Administracja | <span class="text-muted">Użytkownicy</span></h3>
                            <small>
                                Możliwość edycji danych użytkowników oraz tworzenia nowych kont
                            </small>
                        </div>
                    </div>
                    <hr>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12">
                    <div class="panel panel-filled">
                        <div class="panel-heading">
                            {% if us_auth == 'Super Admin' %}
                                <div class="panel-tools">
                                    <button class="btn btn-w-md btn-success" data-toggle="modal" data-target="#modalADD">Dodaj użytkownika</button>
                                </div>
                            {% endif %}
                            Tabelaryczna lista wszystkich uprawnionych do zarządzania aplikacją

                        </div>
                        <div class="panel-body">
                            <p>
                                Wskazówka: pole <code>Szukaj</code> pomoże w szybkim odnalezieniu osoby a kliknięcie w daną wartość w kolumnie pozwoli na szybką edycję danych
                            </p>
                            <div class="table-responsive">
                                <table id="tableExample2" class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>Imię</th>
                                            <th>Nazwisko</th>
                                            <th>E-mail</th>
                                            <th>Hasło</th>
                                            <th>Uprawnienia</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>

                                    {% for user in users %}
                                    <tr>
                                        <td><a href="#" class="popup_edit" data-type="text" data-pk="{{ user.us_id }}" data-url="{{ base_url('back/administration/inline_update') }}" data-name="us_fname">{{ user.us_fname }}</a></td>
                                        <td><a href="#" class="popup_edit" data-type="text" data-pk="{{ user.us_id }}" data-url="{{ base_url('back/administration/inline_update') }}" data-name="us_lname">{{ user.us_lname }}</a></td>
                                        {% if(us_auth == 'Super Admin') %}
                                        <td><a href="#" class="popup_edit" data-type="text" data-pk="{{ user.us_id }}" data-url="{{ base_url('back/administration/inline_update') }}" data-name="us_email">{{ user.us_email }}</a></td>
                                        {% else %}
                                        <td><span data-toggle="tooltip" data-placement="bottom" title="Brak uprawnień do zmiany">{{ user.us_email }}</span></td>
                                        {% endif %}
                                        <td><a href="#" class="popup_edit" data-type="password" data-pk="{{ user.us_id }}" data-url="{{ base_url('back/administration/inline_update') }}" data-name="us_pass">*****</a></td>
                                        <td><span class="label label-success">{{ user.us_auth }}</span></td>
                                        {% if(us_auth == 'Super Admin') %}
                                        <td><a href="#" class="popup_edit" data-type="select" data-pk="{{ user.us_id }}" data-url="{{ base_url('back/administration/inline_update') }}" data-name="us_status" data-source="[{'value':'Aktywny', 'text':'Aktywny'},{'value':'Nieaktywny', 'text':'Nieaktywny'}]" data-value="{{ user.us_status }}">{{ user.us_status }}</a></td>
                                        {% else %}
                                        <td><span data-toggle="tooltip" data-placement="bottom" title="Brak uprawnień do zmiany">{{ user.us_status }}</span></td>
                                        {% endif %}
                                    </tr>
                                    {% endfor %}

                                    </tbody>
                                </table>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <div class="modal fade" id="modalADD" tabindex="-1" role="dialog" aria-hidden="true" style="display: none;">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header text-center">
                    <h4 class="modal-title">Użytkownik</h4>
                    <small>Dodaj nowego użytkownika</small>
                </div>
                <div class="modal-body">

                    {{ form_open('', 'class="form-horizontal"') }}
                    <div class="form-group"><label for="us_fname" class="col-sm-4 control-label">Imię <code>*</code></label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" id="us_fname" placeholder="Proszę podać imię" name="us_fname">
                            </div>
                        </div>

                        <div class="form-group"><label for="us_lname" class="col-sm-4 control-label">Nazwisko <code>*</code></label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" id="us_lname" placeholder="Proszę podać nazwisko" name="us_lname">
                            </div>
                        </div>

                        <div class="form-group"><label for="us_email" class="col-sm-4 control-label">E-mail <code>*</code></label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" id="us_email" placeholder="Proszę podać adres poczty elektronicznej" name="us_email">
                            </div>
                        </div>

                        <div class="form-group"><label for="us_pass" class="col-sm-4 control-label">Hasło <code>*</code></label>
                            <div class="col-sm-8">
                                <input type="password" class="form-control" id="us_pass" placeholder="*****" name="us_pass">
                            </div>
                        </div>

                        <div class="form-group"><label for="pass_conf" class="col-sm-4 control-label">Powtórz hasło <code>*</code></label>
                            <div class="col-sm-8">
                                <input type="password" class="form-control" id="pass_conf" placeholder="*****" name="pass_conf">
                            </div>
                        </div>
                        <!--</form>-->

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Anuluj</button>
                    <input type="submit" class="btn btn-accent" value="Dodaj">
                </div>
                {{ form_close() }}

            </div>
        </div>
    </div>
{% endblock %}

{% block vendor_scripts %}
    {{ parent() }}
    <script src="{{ base_url('assets/back/vendor/datatables/datatables.min.js') }}"></script>

    <script>
    $(document).ready(function () {
        $('#tableExample2').DataTable({
            "dom": "<'row'<'col-sm-6'l><'col-sm-6'f>>t<'row'<'col-sm-6'i><'col-sm-6'p>>",
            "lengthMenu": [ [6, 25, 50, -1], [6, 25, 50, "Wszystko"] ],
            "iDisplayLength": 6,

            "fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {

                $('.popup_edit').editable({
                    ajaxOptions: {
                        dataType: 'json' //assuming json response
                    },
                    emptytext: 'Brak danych',
                    success: function(data, newValue) {
                        if(data.status == 0) {
                            return data.msg; // Message will be shown in editable form
                        } else {
                            setTimeout(function(){ // Run toastr notification with success message
                                toastr.options = {
                                    "positionClass": "toast-top-right",
                                    "closeButton": true,
                                    "progressBar": true,
                                    "showEasing": "swing",
                                    "timeOut": "6000"
                                };
                                toastr.success('<strong>Sukces! </strong> <br/><small>' + data.msg + '</small>');
                                },500
                            );
                        }
                    }
                });
            }
        });
    });

    $(function () {
        $('[data-toggle="tooltip"]').tooltip()
    })
</script>
{% endblock %}